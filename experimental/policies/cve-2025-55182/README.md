# CVE-2025-55182 Detection Policy

## Description

This policy defines security rules to detect potential post-exploitation of CVE-2025-55182 (React2Shell), a critical remote code execution vulnerability in React Server Components. 

### About CVE-2025-55182 (React2Shell)

This experimental rule detects suspicious behavior patterns by monitoring for shell execution, HTTP utilities, or shell utilities spawned from Node.js parent processes, which is characteristic of CVE-2025-55182 post-exploitation activities.

### References

**Original Proof of Concept:**
- [React2Shell Original PoC Repository](https://github.com/lachlan2k/React2Shell-CVE-2025-55182-original-poc) - Contains the original submitted PoCs by Lachlan Davidson

**Detailed Analysis:**
- [Datadog Security Labs: CVE-2025-55182 (React2Shell) Analysis](https://securitylabs.datadoghq.com/articles/cve-2025-55182-react2shell-remote-code-execution-react-server-components/) - Comprehensive technical analysis, exploitation details, and IOCs

**How the Attack Works:**
The vulnerability is a server-side prototype pollution vulnerability that exploits the React Flight protocol. The patch (merged December 3, 2024) added a `hasOwnProperty` check to prevent prototype chain traversal:

```javascript
// Before (vulnerable):
return moduleExports[metadata[NAME]];

// After (patched):
if (hasOwnProperty.call(moduleExports, metadata[NAME])) {
  return moduleExports[metadata[NAME]];
}
```

Attackers exploit this by sending specially crafted payloads with parameters like `$ACTION_REF_0` that manipulate the prototype chain to execute native Node.js functions such as `child_process.execSync`. The vulnerability is confirmed exploitable even in blank Next.js applications created with `create-next-app`.

### Affected Versions
- react-server-dom-webpack: < 19.2.0
- react-server-dom-turbopack: < 19.2.0
- Next.js: < 15.0.5

### Fixed Versions
- react-server-dom-webpack: >= 19.2.0
- react-server-dom-turbopack: >= 19.2.0
- Next.js: >= 15.0.5

## Installation

### 1. Configure Variables

Set up the required variables for your DataDog environment:

```bash
export TF_VAR_api_key=your-datadog-api-key
export TF_VAR_app_key=your-datadog-app-key
export TF_VAR_url=https://app.datadoghq.com  # or your regional URL
```

### 2. Deploy Policy

```bash
# Initialization
terraform init

# Plan the deployment
terraform plan

# Apply the configuration
terraform apply
```

## Using Docker

For containerized deployments, you can use the provided Dockerfile:

```bash
# Initialization
docker run -it -v ./policies:/policies -w /policies/cve-2025-55182 \
-e TF_VAR_api_key=$TF_VAR_api_key \
-e TF_VAR_app_key=$TF_VAR_app_key \
-e TF_VAR_url=$TF_VAR_url \
hashicorp/terraform init

# Plan the deployment
docker run -it -v ./policies:/policies -w /policies/cve-2025-55182 \
-e TF_VAR_api_key=$TF_VAR_api_key \
-e TF_VAR_app_key=$TF_VAR_app_key \
-e TF_VAR_url=$TF_VAR_url \
hashicorp/terraform plan

# Apply the configuration
docker run -it -v ./policies:/policies -w /policies/cve-2025-55182 \
-e TF_VAR_api_key=$TF_VAR_api_key \
-e TF_VAR_app_key=$TF_VAR_app_key \
-e TF_VAR_url=$TF_VAR_url \
hashicorp/terraform apply
```

## Detection Logic

The rule monitors for the following suspicious pattern:

```
(exec.file.path in SHELLS || 
 exec.comm in HTTP_UTILS || 
 exec.file.path in SHELL_UTILS) && 
process.parent.file.name == "node"
```

This pattern detects when a Node.js process spawns:
- Shell executables (bash, sh, zsh, etc.)
- HTTP utilities (wget, curl, lwp-download)
- Shell utilities (cat, chmod, env, whoami, etc.)
