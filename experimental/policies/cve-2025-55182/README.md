# CVE-2025-55182 Detection Policy

## Description

This policy defines security rules to detect potential exploitation of CVE-2025-55182, a critical remote code execution vulnerability in React Server Components. The vulnerability exists in the `react-server-dom-webpack` and `react-server-dom-turbopack` packages due to a prototype chain access issue in the `requireModule()` function.

### About CVE-2025-55182

CVE-2025-55182 is a prototype chain vulnerability in React Server Components that allows attackers to execute arbitrary code on the server. The vulnerability occurs when exports are accessed via bracket notation without `hasOwnProperty` checks, enabling attackers to invoke dangerous Node.js built-in modules like `vm`, `child_process`, and `fs` through prototype chain traversal.

**Attack Vector:** Attackers can send malicious `$ACTION_REF` payloads with bound action metadata to execute:
- Arbitrary JavaScript via `vm#runInThisContext`
- Shell commands via `child_process#execSync`
- File operations via `fs#readFileSync` / `fs#writeFileSync`

This experimental rule detects suspicious behavior patterns by monitoring for shell execution, HTTP utilities, or shell utilities spawned from Node.js parent processes, which is characteristic of CVE-2025-55182 exploitation.

### Reference
- POC Repository: https://github.com/ejpir/CVE-2025-55182-poc
- CVE Details: CVE-2025-55182

### Affected Versions
- react-server-dom-webpack: < 19.2.0
- react-server-dom-turbopack: < 19.2.0
- Next.js: < 15.0.5

### Fixed Versions
- react-server-dom-webpack: >= 19.2.0
- react-server-dom-turbopack: >= 19.2.0
- Next.js: >= 15.0.5

## Installation

### 1. Configure Variables

Set up the required variables for your DataDog environment:

```bash
export TF_VAR_api_key=your-datadog-api-key
export TF_VAR_app_key=your-datadog-app-key
export TF_VAR_url=https://app.datadoghq.com  # or your regional URL
```

### 2. Deploy Policy

```bash
# Initialization
terraform init

# Plan the deployment
terraform plan

# Apply the configuration
terraform apply
```

## Using Docker

For containerized deployments, you can use the provided Dockerfile:

```bash
# Initialization
docker run -it -v ./policies:/policies -w /policies/cve-2025-55182 \
-e TF_VAR_api_key=$TF_VAR_api_key \
-e TF_VAR_app_key=$TF_VAR_app_key \
-e TF_VAR_url=$TF_VAR_url \
hashicorp/terraform init

# Plan the deployment
docker run -it -v ./policies:/policies -w /policies/cve-2025-55182 \
-e TF_VAR_api_key=$TF_VAR_api_key \
-e TF_VAR_app_key=$TF_VAR_app_key \
-e TF_VAR_url=$TF_VAR_url \
hashicorp/terraform plan

# Apply the configuration
docker run -it -v ./policies:/policies -w /policies/cve-2025-55182 \
-e TF_VAR_api_key=$TF_VAR_api_key \
-e TF_VAR_app_key=$TF_VAR_app_key \
-e TF_VAR_url=$TF_VAR_url \
hashicorp/terraform apply
```

## Detection Logic

The rule monitors for the following suspicious pattern:

```
(exec.file.path in SHELLS || 
 exec.comm in HTTP_UTILS || 
 exec.file.path in SHELL_UTILS) && 
process.parent.file.name == "node"
```

This pattern detects when a Node.js process spawns:
- Shell executables (bash, sh, zsh, etc.)
- HTTP utilities (wget, curl, lwp-download)
- Shell utilities (cat, chmod, env, whoami, etc.)

These behaviors are consistent with successful exploitation of CVE-2025-55182 where attackers use `vm#runInThisContext`, `child_process#execSync`, or similar gadgets to execute commands.

