schema:
  version: 1.0.0
name: CIS Kubernetes
framework: cis-kubernetes
version: 1.5.1
rules:
  - id: cis-kubernetes-1.5.1-1.1.4
    description: '[Deprecated] The controller manager pod specification file ownership should be root:root'
    scope:
      - kubernetesNode
    imports:
      - file-owner-rule-common.rego
      - helpers.rego
    input:
      - file:
          path: /etc/kubernetes/manifests/kube-controller-manager.yaml
      - constants:
          user: root
          group: root
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.1.5
    description: '[Deprecated] The scheduler pod specification file should have permissions of 644 or stricter'
    scope:
      - kubernetesNode
    imports:
      - file-permissions-common.rego
      - helpers.rego
    input:
      - file:
          path: /etc/kubernetes/manifests/kube-scheduler.yaml
      - constants:
          max_permissions: '644'
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.1.6
    description: '[Deprecated] The scheduler pod specification file ownership should be set to root'
    scope:
      - kubernetesNode
    imports:
      - file-owner-rule-common.rego
      - helpers.rego
    input:
      - file:
          path: /etc/kubernetes/manifests/kube-scheduler.yaml
      - constants:
          user: root
          group: root
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.1.7
    description: '[Deprecated] The /etc/kubernetes/manifests/etcd.yaml file should have permissions of 644 or stricter'
    scope:
      - kubernetesNode
    imports:
      - file-permissions-common.rego
      - helpers.rego
    input:
      - file:
          path: /etc/kubernetes/manifests/etcd.yaml
      - constants:
          max_permissions: '644'
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.1.8
    description: '[Deprecated The /etc/kubernetes/manifests/etcd.yaml file ownership should be root:root'
    scope:
      - kubernetesNode
    imports:
      - file-owner-rule-common.rego
      - helpers.rego
    input:
      - file:
          path: /etc/kubernetes/manifests/etcd.yaml
      - constants:
          user: root
          group: root
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.1.11
    description: '[Deprecated] Etcd data directory should have permissions of 700 or more restrictive'
    scope:
      - kubernetesNode
    imports:
      - file-permissions-common.rego
      - helpers.rego
    input:
      - file:
          path: process.flag("etcd", "--data-dir")
      - constants:
          max_permissions: '700'
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.1.12
    description: '[Deprecated] The etcd data directory should be owned by etcd:etcd'
    scope:
      - kubernetesNode
    imports:
      - file-owner-rule-common.rego
      - helpers.rego
    input:
      - file:
          path: process.flag("etcd", "--data-dir")
      - constants:
          user: etcd
          group: etcd
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.1.13
    description: '[Deprecated] The admin.conf file should have permissions of 644 or more restrictive'
    scope:
      - kubernetesNode
    imports:
      - file-permissions-common.rego
      - helpers.rego
    input:
      - file:
          path: /etc/kubernetes/admin.conf
      - constants:
          max_permissions: '644'
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.1.14
    description: '[Deprecated] The ownership of the admin.conf file should be root:root'
    scope:
      - kubernetesNode
    imports:
      - file-owner-rule-common.rego
      - helpers.rego
    input:
      - file:
          path: /etc/kubernetes/admin.conf
      - constants:
          user: root
          group: root
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.1.15
    description: '[Deprecated] Scheduler.conf file should only be alterable by owners with permissions of 644 or more restrictive'
    scope:
      - kubernetesNode
    imports:
      - file-permissions-common.rego
      - helpers.rego
    input:
      - file:
          path: /etc/kubernetes/scheduler.conf
      - constants:
          max_permissions: '644'
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.1.16
    description: '[Deprecated] The scheduler.conf file should be owned by root:root'
    scope:
      - kubernetesNode
    imports:
      - file-owner-rule-common.rego
      - helpers.rego
    input:
      - file:
          path: /etc/kubernetes/scheduler.conf
      - constants:
          user: root
          group: root
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.1.17
    description: '[Deprecated] The controller-manager.conf file should have permissions of 644 or more restrictive'
    scope:
      - kubernetesNode
    imports:
      - file-permissions-common.rego
      - helpers.rego
    input:
      - file:
          path: /etc/kubernetes/controller-manager.conf
      - constants:
          max_permissions: '644'
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.1.18
    description: '[Deprecated] The controller-manager.conf file should be owned by root:root'
    scope:
      - kubernetesNode
    imports:
      - file-owner-rule-common.rego
      - helpers.rego
    input:
      - file:
          path: /etc/kubernetes/controller-manager.conf
      - constants:
          user: root
          group: root
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.1.19
    description: '[Deprecated] The Kubernetes PKI directory should be owned by root'
    scope:
      - kubernetesNode
    imports:
      - file-owner-rule-common.rego
      - helpers.rego
    input:
      - file:
          path: /etc/kubernetes/pki/
      - constants:
          user: root
          group: root
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.1.20
    description: '[Deprecated] Kubernetes PKI certificate files should have permissions of 644 or more restrictive'
    scope:
      - kubernetesNode
    input:
      - tag: files
        file:
          path: /etc/kubernetes/pki/*.crt
        type: array
      - constants:
          max_permissions: '644'
          resource_type: kubernetes_master_node
    imports:
      - cis-docker-1.2.0-3.8.rego
      - helpers.rego
  - id: cis-kubernetes-1.5.1-1.2.2
    description: '[Deprecated] The API server should not use basic authentication'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: kube-apiserver
      - constants:
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.2.3
    description: '[Deprecated] The API server should use secure authentication methods without token based authentication'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: kube-apiserver
      - constants:
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.2.4
    description: '[Deprecated] Kubelet connections should use HTTPS for enhanced security'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: kube-apiserver
      - constants:
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.2.5
    description: '[Deprecated] Kubelet authentication should require certificate-based authentication'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: kube-apiserver
      - constants:
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.2.6
    description: '[Deprecated] The API server should verify the kubelet''s certificate before connecting'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: kube-apiserver
      - constants:
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.2.7
    description: '[Deprecated] API server should only authorize explicitly authorized requests'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: kube-apiserver
      - constants:
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.2.8
    description: '[Deprecated] Kubelet nodes should only read objects associated with them'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: kube-apiserver
      - constants:
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.2.9
    description: '[Deprecated] RBAC should be enabled for the API server'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: kube-apiserver
      - constants:
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.2.16
    description: '[Deprecated] PodSecurityPolicy should be enabled to reject non-compliant pod creations'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: kube-apiserver
      - constants:
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.2.18
    description: '[Deprecated] The insecure API service should not be bound'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: kube-apiserver
      - constants:
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.2.19
    description: '[Deprecated] The API server should only bind to secure, known ports'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: kube-apiserver
      - constants:
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.2.20
    description: '[Deprecated] The secure port should not be disabled for the API server'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: kube-apiserver
      - constants:
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.2.21
    description: '[Deprecated] Profiling for API server should be disabled, if not needed'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: kube-apiserver
      - constants:
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.2.22
    description: '[Deprecated] The Kubernetes API Server should enable audit logs on its server'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: kube-apiserver
      - constants:
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.2.23
    description: '[Deprecated] Logs for API server audits should be retained for 30 days'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: kube-apiserver
      - constants:
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.2.24
    description: '[Deprecated] The misconfigured resource should retain at least 10 log file rotations'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: kube-apiserver
      - constants:
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.2.25
    description: '[Deprecated] Log files for the API server should be rotated at 100 MB'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: kube-apiserver
      - constants:
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.2.26
    description: '[Deprecated] The global request timeout for API server requests should be set appropriately'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: kube-apiserver
      - constants:
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.2.27
    description: '[Deprecated] The API server should validate the service account token in etcd'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: kube-apiserver
      - constants:
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.2.28
    description: '[Deprecated] The API server should explicitly set a service account public key file'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: kube-apiserver
      - constants:
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.2.29
    description: '[Deprecated] etcd servers should make use of TLS encryption for client connections'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: kube-apiserver
      - constants:
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.2.30
    description: '[Deprecated] The API server should have a TLS connection setup'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: kube-apiserver
      - constants:
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.2.31
    description: '[Deprecated] The API server should set up TLS connection for client authentication'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: kube-apiserver
      - constants:
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.2.32
    description: '[Deprecated] etcd should use TLS encryption for client connections'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: kube-apiserver
      - constants:
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.2.33
    description: '[Deprecated] Etcd key-value store should be encrypted at rest'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: kube-apiserver
      - constants:
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.3.2
    description: '[Deprecated] Controller Manager profiling should be disabled'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: kube-controller-manager
      - constants:
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.3.3
    description: '[Deprecated] Each controller should use individual service account credentials'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: kube-controller-manager
      - constants:
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.3.4
    description: '[Deprecated] Service accounts on the controller manager should have a private key file set'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: kube-controller-manager
      - constants:
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.3.5
    description: '[Deprecated] Pods should verify the API server''s serving certificate before connecting'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: kube-controller-manager
      - constants:
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.3.6
    description: '[Deprecated] The kubelet server certificate rotation on controller-manager should be enabled'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: kube-controller-manager
      - constants:
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.3.7
    description: '[Deprecated] The Controller Manager API service should only bind to localhost'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: kube-controller-manager
      - constants:
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.4.1
    description: '[Deprecated] Scheduler profiling should be disabled'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: kube-scheduler
      - constants:
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-1.4.2
    description: '[Deprecated] The scheduler service should only be bound to localhost'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: kube-scheduler
      - constants:
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-2.1
    description: '[Deprecated] The etcd service should be configured with TLS encryption'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: etcd
      - constants:
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-2.2
    description: '[Deprecated] Etcd service should have client authentication enabled'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: etcd
      - constants:
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-2.3
    description: '[Deprecated] Self-signed certificates should not be used for etcd TLS'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: etcd
      - constants:
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-2.4
    description: '[Deprecated] Etcd should use TLS encryption for peer connections'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: etcd
      - constants:
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-2.5
    description: '[Deprecated] Etcd should be configured for peer authentication'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: etcd
      - constants:
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-2.6
    description: '[Deprecated] TLS connections between etcd peers should not use self-signed certificates'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: etcd
      - constants:
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-3.2.1
    description: '[Deprecated] The --audit-policy-file flag should be set for Kubernetes logging to be enabled'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: kube-apiserver
      - constants:
          resource_type: kubernetes_master_node
  - id: cis-kubernetes-1.5.1-4.1.1
    description: '[Deprecated] The kubelet service file should have permissions of 644 or stricter'
    scope:
      - kubernetesNode
    imports:
      - file-permissions-common.rego
      - helpers.rego
    input:
      - file:
          path: /usr/lib/systemd/system/kubelet.service
      - constants:
          max_permissions: '644'
          resource_type: kubernetes_worker_node
  - id: cis-kubernetes-1.5.1-4.1.2
    description: '[Deprecated] The kubelet service file should be owned by root:root'
    scope:
      - kubernetesNode
    imports:
      - file-owner-rule-common.rego
      - helpers.rego
    input:
      - file:
          path: /usr/lib/systemd/system/kubelet.service
      - constants:
          user: root
          group: root
          resource_type: kubernetes_worker_node
  - id: cis-kubernetes-1.5.1-4.1.3
    description: '[Deprecated] The proxy kubeconfig file should have permissions of 644 or stricter'
    scope:
      - kubernetesNode
    imports:
      - file-permissions-common.rego
      - helpers.rego
    input:
      - file:
          path: /var/lib/kube-proxy/kubeconfig
      - constants:
          max_permissions: '644'
          resource_type: kubernetes_worker_node
  - id: cis-kubernetes-1.5.1-4.1.4
    description: '[Deprecated] The kube-proxy configuration file should be owned by root:root'
    scope:
      - kubernetesNode
    imports:
      - file-owner-rule-common.rego
      - helpers.rego
    input:
      - file:
          path: /var/lib/kube-proxy/kubeconfig
      - constants:
          user: root
          group: root
          resource_type: kubernetes_worker_node
  - id: cis-kubernetes-1.5.1-4.1.5
    description: '[Deprecated] The kubelet.conf file should have permissions of 644 or stricter'
    scope:
      - kubernetesNode
    imports:
      - file-permissions-common.rego
      - helpers.rego
    input:
      - file:
          path: /etc/kubernetes/kubelet.conf
      - constants:
          max_permissions: '644'
          resource_type: kubernetes_worker_node
  - id: cis-kubernetes-1.5.1-4.1.6
    description: '[Deprecated] The kubelet.conf file should be owned by root'
    scope:
      - kubernetesNode
    imports:
      - file-owner-rule-common.rego
      - helpers.rego
    input:
      - file:
          path: /etc/kubernetes/kubelet.conf
      - constants:
          user: root
          group: root
          resource_type: kubernetes_worker_node
  - id: cis-kubernetes-1.5.1-4.1.7
    description: '[Deprecated] The certificate authorities file should have permissions of 644 or stricter'
    scope:
      - kubernetesNode
    imports:
      - file-permissions-common.rego
      - helpers.rego
    input:
      - file:
          path: process.flag("kubelet", "--client-ca-file")
      - constants:
          max_permissions: '644'
          resource_type: kubernetes_worker_node
  - id: cis-kubernetes-1.5.1-4.1.8
    description: '[Deprecated] The certificate authorities file should be owned by root:root'
    scope:
      - kubernetesNode
    imports:
      - file-owner-rule-common.rego
      - helpers.rego
    input:
      - file:
          path: process.flag("kubelet", "--client-ca-file")
      - constants:
          user: root
          group: root
          resource_type: kubernetes_worker_node
  - id: cis-kubernetes-1.5.1-4.1.9
    description: '[Deprecated] The kubelet configuration file should have permissions of 644 or more restrictive'
    scope:
      - kubernetesNode
    imports:
      - file-permissions-common.rego
      - helpers.rego
    input:
      - file:
          path: process.flag("kubelet", "--config")
      - constants:
          max_permissions: '644'
          resource_type: kubernetes_worker_node
  - id: cis-kubernetes-1.5.1-4.1.10
    description: '[Deprecated] The kubelet configuration file should be owned by root:root'
    scope:
      - kubernetesNode
    imports:
      - file-owner-rule-common.rego
      - helpers.rego
    input:
      - file:
          path: process.flag("kubelet", "--config")
      - constants:
          user: root
          group: root
          resource_type: kubernetes_worker_node
  - id: cis-kubernetes-1.5.1-4.2.1
    description: '[Deprecated] The API server should not allow anonymous requests to Kubelet'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: kubelet
      - constants:
          resource_type: kubernetes_worker_node
  - id: cis-kubernetes-1.5.1-4.2.2
    description: '[Deprecated] All requests should not be allowed; explicit authorization should be enabled'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: kubelet
      - constants:
          resource_type: kubernetes_worker_node
  - id: cis-kubernetes-1.5.1-4.2.3
    description: '[Deprecated] Kubelet should enable authentication using certificates for TLS client authentication'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: kubelet
      - constants:
          resource_type: kubernetes_worker_node
  - id: cis-kubernetes-1.5.1-4.2.4
    description: '[Deprecated] The read-only port should be disabled in Kubelet'
    scope:
      - kubernetesNode
    input:
      - process:
          name: kubelet
      - file:
          path: process.flag("kubelet", "--config")
          parser: yaml
      - constants:
          resource_type: kubernetes_worker_node
    imports:
      - helpers.rego
  - id: cis-kubernetes-1.5.1-4.2.5
    description: '[Deprecated] Streaming connections should have timeouts enabled and not be disabled'
    scope:
      - kubernetesNode
    input:
      - process:
          name: kubelet
      - file:
          path: process.flag("kubelet", "--config")
          parser: yaml
      - constants:
          resource_type: kubernetes_worker_node
    imports:
      - helpers.rego
  - id: cis-kubernetes-1.5.1-4.2.6
    description: '[Deprecated] Kubelet default kernel parameter values should be protected from overriding.'
    scope:
      - kubernetesNode
    input:
      - process:
          name: kubelet
      - file:
          path: process.flag("kubelet", "--config")
          parser: yaml
      - constants:
          resource_type: kubernetes_worker_node
    imports:
      - helpers.rego
  - id: cis-kubernetes-1.5.1-4.2.7
    description: '[Deprecated] Kubelet should be able to manage changes to iptables'
    scope:
      - kubernetesNode
    input:
      - process:
          name: kubelet
      - file:
          path: process.flag("kubelet", "--config")
          parser: yaml
      - constants:
          resource_type: kubernetes_worker_node
    imports:
      - helpers.rego
  - id: cis-kubernetes-1.5.1-4.2.10
    description: '[Deprecated] Kubelets should have HTTPS connections with TLS setup'
    scope:
      - kubernetesNode
    input:
      - process:
          name: kubelet
      - file:
          path: process.flag("kubelet", "--config")
          parser: yaml
      - constants:
          resource_type: kubernetes_worker_node
    imports:
      - helpers.rego
  - id: cis-kubernetes-1.5.1-4.2.11
    description: '[Deprecated] Kubelet client certificate rotation should be enabled'
    scope:
      - kubernetesNode
    input:
      - process:
          name: kubelet
      - file:
          path: process.flag("kubelet", "--config")
          parser: yaml
      - constants:
          resource_type: kubernetes_worker_node
    imports:
      - helpers.rego
  - id: cis-kubernetes-1.5.1-4.2.12
    description: '[Deprecated] Kubelet server certificate rotation should be enabled'
    scope:
      - kubernetesNode
    imports:
      - process-common-rule.rego
      - helpers.rego
    input:
      - process:
          name: kubelet
      - constants:
          resource_type: kubernetes_worker_node
  - id: cis-kubernetes-1.5.1-5.1.5
    description: '[Deprecated] The default service account should not be used'
    scope:
      - kubernetesCluster
    input:
      - kubeApiserver:
          kind: serviceaccounts
          version: v1
          fieldSelector: metadata.name=default
          apiRequest:
            verb: list
        type: array
        tag: serviceaccounts
      - kubeApiserver:
          kind: clusterrolebindings
          version: v1
          group: rbac.authorization.k8s.io
          apiRequest:
            verb: list
        type: array
        tag: clusterrolebindings
      - kubeApiserver:
          kind: rolebindings
          version: v1
          group: rbac.authorization.k8s.io
          apiRequest:
            verb: list
        type: array
        tag: rolebindings
      - constants:
          resource_type: kubernetes_cluster
    imports:
      - helpers.rego
  - id: cis-kubernetes-1.5.1-5.2.2
    description: Containers should not be run with the hostPID flag set to true
    scope:
      - kubernetesCluster
    input:
      - tag: policies
        type: array
        kubeApiserver:
          kind: podsecuritypolicies
          version: v1beta1
          group: policy
          apiRequest:
            verb: list
      - constants:
          resource_type: kubernetes_cluster
          spec: hostPID
    imports:
      - psp-rule-common.rego
      - helpers.rego
  - id: cis-kubernetes-1.5.1-5.2.3
    description: Containers should not be generally permitted to run with hostIPC flag
    scope:
      - kubernetesCluster
    input:
      - tag: policies
        type: array
        kubeApiserver:
          kind: podsecuritypolicies
          version: v1beta1
          group: policy
          apiRequest:
            verb: list
      - constants:
          resource_type: kubernetes_cluster
          spec: hostIPC
    imports:
      - psp-rule-common.rego
      - helpers.rego
  - id: cis-kubernetes-1.5.1-5.2.4
    description: Containers should not be allowed to share the host network namespace
    scope:
      - kubernetesCluster
    input:
      - tag: policies
        type: array
        kubeApiserver:
          kind: podsecuritypolicies
          version: v1beta1
          group: policy
          apiRequest:
            verb: list
      - constants:
          resource_type: kubernetes_cluster
          spec: hostNetwork
    imports:
      - psp-rule-common.rego
      - helpers.rego
  - id: cis-kubernetes-1.5.1-5.2.5
    description: Containers should not be run with allowPrivilegeEscalation flag set to true
    scope:
      - kubernetesCluster
    input:
      - tag: policies
        type: array
        kubeApiserver:
          kind: podsecuritypolicies
          version: v1beta1
          group: policy
          apiRequest:
            verb: list
      - constants:
          resource_type: kubernetes_cluster
          spec: allowPrivilegeEscalation
    imports:
      - psp-rule-common.rego
      - helpers.rego
  - id: cis-kubernetes-1.5.1-5.3.2
    description: Network policies should be defined to isolate traffic in cluster network
    scope:
      - kubernetesCluster
    input:
      - kubeApiserver:
          kind: namespaces
          version: v1
          apiRequest:
            verb: list
        type: array
        tag: namespaces
      - kubeApiserver:
          kind: networkpolicies
          version: v1
          group: networking.k8s.io
          apiRequest:
            verb: list
        type: array
        tag: networkpolicies
      - constants:
          resource_type: kubernetes_cluster
    imports:
      - helpers.rego
  - id: cis-kubernetes-1.5.1-5.7.4
    description: Resources should be created in a non-default namespace in Kubernetes
    scope:
      - kubernetesCluster
    input:
      - tag: pods
        type: array
        kubeApiserver:
          kind: pods
          version: v1beta1
          group: policy
          namespace: default
          apiRequest:
            verb: list
      - tag: services
        type: array
        kubeApiserver:
          kind: services
          version: v1
          namespace: default
          fieldSelector: metadata.name!=kubernetes,metadata.name!=openshift
          apiRequest:
            verb: list
      - constants:
          resource_type: kubernetes_cluster
    imports:
      - helpers.rego
