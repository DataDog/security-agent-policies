schema:
  version: 1.0.0
name: CIS Docker Generic
framework: cis-docker
version: 1.2.0
rules:
  - id: cis-docker-1.2.0-1.2.1
    description: The Docker local storage partition should be separate from other partitions
    scope:
      - docker
    input:
      - file:
          path: /proc/mounts
          parser: raw
      - constants:
          regexp: '[a-zA-Z0-9-_/]+ /var/lib/docker [a-zA-Z0-9-_/]+'
          resource_type: docker_daemon
    imports:
      - file-matches-regexp.rego
      - helpers.rego
  - id: cis-docker-1.2.0-1.2.2
    description: The Docker daemon should only be controlled by root and Docker group
    scope:
      - docker
    input:
      - group:
          name: docker
      - constants:
          resource_type: docker_daemon
    imports:
      - helpers.rego
  - id: cis-docker-1.2.0-1.2.3
    description: Docker daemon activities should be audited
    scope:
      - docker
    input:
      - audit:
          path: /usr/bin/dockerd
        type: array
      - constants:
          resource_type: docker_daemon
    imports:
      - audit-rule-common.rego
      - helpers.rego
  - id: cis-docker-1.2.0-1.2.4
    description: /var/lib/docker should be audited
    scope:
      - docker
    input:
      - audit:
          path: /var/lib/docker
        type: array
      - constants:
          resource_type: docker_daemon
    imports:
      - audit-rule-common.rego
      - helpers.rego
  - id: cis-docker-1.2.0-1.2.5
    description: Docker-related files should be audited in /etc/docker
    scope:
      - docker
    input:
      - audit:
          path: /etc/docker
        type: array
      - constants:
          resource_type: docker_daemon
    imports:
      - audit-rule-common.rego
      - helpers.rego
  - id: cis-docker-1.2.0-1.2.6
    description: The docker.service file should have auditing configured if applicable
    scope:
      - docker
    input:
      - audit:
          path: /usr/lib/systemd/system/docker.service
        type: array
      - constants:
          resource_type: docker_daemon
    imports:
      - audit-rule-common.rego
      - helpers.rego
  - id: cis-docker-1.2.0-1.2.7
    description: The docker.socket file should be audited, if applicable
    scope:
      - docker
    input:
      - audit:
          path: /usr/lib/systemd/system/docker.socket
        type: array
      - constants:
          resource_type: docker_daemon
    imports:
      - audit-rule-common.rego
      - helpers.rego
  - id: cis-docker-1.2.0-1.2.8
    description: The default Docker configuration file should be audited, if applicable
    scope:
      - docker
    input:
      - audit:
          path: /etc/default/docker
        type: array
      - constants:
          resource_type: docker_daemon
    imports:
      - audit-rule-common.rego
      - helpers.rego
  - id: cis-docker-1.2.0-1.2.9
    description: The default Docker configuration file should be audited on RHEL
    scope:
      - docker
    input:
      - audit:
          path: /etc/sysconfig/docker
        type: array
      - constants:
          resource_type: docker_daemon
    imports:
      - audit-rule-common.rego
      - helpers.rego
  - id: cis-docker-1.2.0-1.2.10
    description: The Docker daemon configuration file should be audited if applicable
    scope:
      - docker
    imports:
      - audit-rule-common.rego
      - helpers.rego
    input:
      - audit:
          path: /etc/docker/daemon.json
        type: array
      - constants:
          resource_type: docker_daemon
  - id: cis-docker-1.2.0-1.2.11
    description: /usr/bin/containerd should be audited if applicable
    scope:
      - docker
    input:
      - audit:
          path: /usr/bin/containerd
        type: array
      - constants:
          resource_type: docker_daemon
    imports:
      - audit-rule-common.rego
      - helpers.rego
  - id: cis-docker-1.2.0-1.2.12
    description: The /usr/sbin/runc executable should be audited, if applicable
    scope:
      - docker
    input:
      - audit:
          path: /usr/sbin/runc
        type: array
      - constants:
          resource_type: docker_daemon
    imports:
      - audit-rule-common.rego
      - helpers.rego
  - id: cis-docker-1.2.0-2.1
    description: Containers on the default network bridge should restrict network traffic
    scope:
      - docker
    input:
      - tag: networks
        docker:
          kind: network
        type: array
      - constants:
          resource_type: docker_network
    imports:
      - helpers.rego
  - id: cis-docker-1.2.0-2.2
    description: The Docker daemon log level should be set to 'info'
    scope:
      - docker
    input:
      - file:
          path: /etc/docker/daemon.json
          parser: json
      - process:
          name: dockerd
      - constants:
          resource_type: docker_daemon
    imports:
      - helpers.rego
  - id: cis-docker-1.2.0-2.3
    description: The Docker daemon should be allowed to configure the firewall rules
    scope:
      - docker
    skipOnKubernetes: true
    input:
      - file:
          path: /etc/docker/daemon.json
          parser: json
      - process:
          name: dockerd
      - constants:
          resource_type: docker_daemon
    imports:
      - helpers.rego
  - id: cis-docker-1.2.0-2.4
    description: Private registry should use TLS encryption for a secure Docker environment
    scope:
      - docker
    imports:
      - docker-info-rule-common.rego
      - helpers.rego
    input:
      - tag: infos
        docker:
          kind: info
        type: array
      - constants:
          resource_type: docker_daemon
  - id: cis-docker-1.2.0-2.5
    description: The Docker instance should not use AUFS as its storage driver
    scope:
      - docker
    imports:
      - docker-info-rule-common.rego
      - helpers.rego
    input:
      - tag: infos
        docker:
          kind: info
        type: array
      - constants:
          resource_type: docker_daemon
  - id: cis-docker-1.2.0-2.6
    description: TLS authentication should be enabled for Docker daemon to restrict remote access
    scope:
      - docker
    skipOnKubernetes: true
    input:
      - process:
          name: kubelet
      - file:
          path: process.flag("kubelet", "--config")
      - tag: config
        file:
          path: /etc/docker/daemon.json
        parser: yaml
      - constants:
          resource_type: docker_daemon
    imports:
      - helpers.rego
  - id: cis-docker-1.2.0-3.1
    description: The docker.service file ownership and group should be set to root
    scope:
      - docker
    imports:
      - file-owner-rule-common.rego
      - helpers.rego
    input:
      - file:
          path: /usr/lib/systemd/system/docker.service
      - constants:
          user: root
          group: root
          resource_type: docker_daemon
  - id: cis-docker-1.2.0-3.2
    description: The docker.service file permissions should be set to 644
    scope:
      - docker
    imports:
      - file-permissions-common.rego
      - helpers.rego
    input:
      - file:
          path: /usr/lib/systemd/system/docker.service
      - constants:
          max_permissions: '644'
          resource_type: docker_daemon
  - id: cis-docker-1.2.0-3.3
    description: The docker.socket file should be owned by root
    scope:
      - docker
    imports:
      - file-owner-rule-common.rego
      - helpers.rego
    input:
      - file:
          path: /usr/lib/systemd/system/docker.socket
      - constants:
          user: root
          group: root
          resource_type: docker_daemon
  - id: cis-docker-1.2.0-3.4
    description: The file permissions on docker.socket should be set to 644 or stricter
    scope:
      - docker
    imports:
      - file-permissions-common.rego
      - helpers.rego
    input:
      - file:
          path: /usr/lib/systemd/system/docker.socket
      - constants:
          max_permissions: '644'
          resource_type: docker_daemon
  - id: cis-docker-1.2.0-3.5
    description: The /etc/docker directory should be owned by root account
    scope:
      - docker
    imports:
      - file-owner-rule-common.rego
      - helpers.rego
    input:
      - file:
          path: /etc/docker
      - constants:
          user: root
          group: root
          resource_type: docker_daemon
  - id: cis-docker-1.2.0-3.6
    description: The /etc/docker directory permissions should be set to 755 or stricter
    scope:
      - docker
    input:
      - file:
          path: /etc/docker
      - constants:
          max_permissions: '755'
          resource_type: docker_daemon
    imports:
      - file-permissions-common.rego
      - helpers.rego
  - id: cis-docker-1.2.0-3.7
    description: The registry certificate files should be individually and group owned by root
    scope:
      - docker
    input:
      - file:
          path: /etc/docker/certs.d/*.crt
      - constants:
          user: root
          group: root
          resource_type: docker_daemon
    imports:
      - helpers.rego
  - id: cis-docker-1.2.0-3.8
    description: The registry certificate files should have read-only or stricter permissions
    scope:
      - docker
    input:
      - file:
          path: /etc/docker/certs.d/*.crt
        type: array
        tag: files
      - constants:
          max_permissions: '444'
          resource_type: docker_daemon
    imports:
      - helpers.rego
  - id: cis-docker-1.2.0-3.9
    description: The TLS CA certificate file should be owned by root account
    scope:
      - docker
    skipOnKubernetes: true
    imports:
      - file-owner-rule-common.rego
      - helpers.rego
    input:
      - file:
          path: process.flag("dockerd", "--tlscacert")
      - constants:
          user: root
          group: root
          resource_type: docker_daemon
  - id: cis-docker-1.2.0-3.10
    description: The TLS CA certificate file should have read-only or more restrictive permissions
    scope:
      - docker
    skipOnKubernetes: true
    imports:
      - file-permissions-common.rego
      - helpers.rego
    input:
      - file:
          path: process.flag("dockerd", "--tlscacert")
      - constants:
          max_permissions: '444'
          resource_type: docker_daemon
  - id: cis-docker-1.2.0-3.11
    description: The Docker server certificate file should be owned by root
    scope:
      - docker
    skipOnKubernetes: true
    imports:
      - file-owner-rule-common.rego
      - helpers.rego
    input:
      - file:
          path: process.flag("dockerd", "--tlscert")
      - constants:
          user: root
          group: root
          resource_type: docker_daemon
  - id: cis-docker-1.2.0-3.12
    description: The Docker server certificate file should have read-only or more restrictive permissions
    scope:
      - docker
    skipOnKubernetes: true
    imports:
      - file-permissions-common.rego
      - helpers.rego
    input:
      - file:
          path: process.flag("dockerd", "--tlscert")
      - constants:
          max_permissions: '444'
          resource_type: docker_daemon
  - id: cis-docker-1.2.0-3.13
    description: The Docker server certificate key file should be owned by root
    scope:
      - docker
    skipOnKubernetes: true
    imports:
      - file-owner-rule-common.rego
      - helpers.rego
    input:
      - file:
          path: process.flag("dockerd", "--tlskey")
      - constants:
          user: root
          group: root
          resource_type: docker_daemon
  - id: cis-docker-1.2.0-3.14
    description: The Docker server certificate key file needs to have permissions of 400
    scope:
      - docker
    skipOnKubernetes: true
    imports:
      - file-permissions-common.rego
      - helpers.rego
    input:
      - file:
          path: process.flag("dockerd", "--tlskey")
      - constants:
          max_permissions: '400'
          resource_type: docker_daemon
  - id: cis-docker-1.2.0-3.15
    description: The Docker socket file should be owned by root and Docker group
    scope:
      - docker
    imports:
      - file-owner-rule-common.rego
      - helpers.rego
    input:
      - file:
          path: /var/run/docker.sock
      - constants:
          user: root
          group: docker
          resource_type: docker_daemon
  - id: cis-docker-1.2.0-3.16
    description: The Docker socket file should have permissions of 660 or stricter
    scope:
      - docker
    imports:
      - file-permissions-common.rego
      - helpers.rego
    input:
      - file:
          path: /var/run/docker.sock
      - constants:
          max_permissions: '660'
          resource_type: docker_daemon
  - id: cis-docker-1.2.0-3.17
    description: The daemon.json file should have user and group ownership set to root
    scope:
      - docker
    imports:
      - file-owner-rule-common.rego
      - helpers.rego
    input:
      - file:
          path: /etc/docker/daemon.json
      - constants:
          user: root
          group: root
          resource_type: docker_daemon
  - id: cis-docker-1.2.0-3.18
    description: The daemon.json file should have permissions set to 644 or stricter
    scope:
      - docker
    imports:
      - file-permissions-common.rego
      - helpers.rego
    input:
      - file:
          path: /etc/docker/daemon.json
      - constants:
          max_permissions: '644'
          resource_type: docker_daemon
  - id: cis-docker-1.2.0-3.19
    description: The /etc/default/docker file ownership should be set to root
    scope:
      - docker
    imports:
      - file-owner-rule-common.rego
      - helpers.rego
    input:
      - file:
          path: /etc/default/docker
      - constants:
          user: root
          group: root
          resource_type: docker_daemon
  - id: cis-docker-1.2.0-3.20
    description: The /etc/sysconfig/docker file should be owned by the root account and group
    scope:
      - docker
    imports:
      - file-owner-rule-common.rego
      - helpers.rego
    input:
      - file:
          path: /etc/sysconfig/docker
      - constants:
          user: root
          group: root
          resource_type: docker_daemon
  - id: cis-docker-1.2.0-3.21
    description: The /etc/sysconfig/docker file permissions should be set to 644 or stricter
    scope:
      - docker
    imports:
      - file-permissions-common.rego
      - helpers.rego
    input:
      - file:
          path: /etc/sysconfig/docker
      - constants:
          max_permissions: '644'
          resource_type: docker_daemon
  - id: cis-docker-1.2.0-3.22
    description: The /etc/default/docker file permissions should be set to 644 or stricter
    scope:
      - docker
    imports:
      - file-permissions-common.rego
      - helpers.rego
    input:
      - file:
          path: /etc/default/docker
      - constants:
          max_permissions: '644'
          resource_type: docker_daemon
  - id: cis-docker-1.2.0-4.1
    description: Containers should run as a non-root user
    scope:
      - docker
    skipOnKubernetes: true
    imports:
      - container-generic-rule.rego
      - helpers.rego
    input:
      - tag: containers
        docker:
          kind: container
        type: array
      - constants:
          resource_type: docker_container
  - id: cis-docker-1.2.0-4.6
    description: Container images should include HEALTHCHECK instructions
    scope:
      - docker
    skipOnKubernetes: true
    input:
      - tag: images
        docker:
          kind: image
        type: array
      - constants:
          resource_type: docker_image
    imports:
      - helpers.rego
  - id: cis-docker-1.2.0-5.1
    description: Containers should have an enabled AppArmor profile
    scope:
      - docker
    skipOnKubernetes: true
    imports:
      - container-generic-rule.rego
      - helpers.rego
    input:
      - tag: containers
        docker:
          kind: container
        type: array
      - constants:
          resource_type: docker_container
  - id: cis-docker-1.2.0-5.2
    description: SELinux security options should be properly configured for effective application security
    scope:
      - docker
    skipOnKubernetes: true
    input:
      - file:
          path: /sys/fs/selinux/enforce
          parser: raw
      - tag: containers
        docker:
          kind: container
        type: array
      - constants:
          resource_type: docker_container
    imports:
      - helpers.rego
  - id: cis-docker-1.2.0-5.3
    description: Kernel capabilities in Linux should only be granted when necessary
    scope:
      - docker
    skipOnKubernetes: true
    imports:
      - container-generic-rule.rego
      - helpers.rego
    input:
      - tag: containers
        docker:
          kind: container
        type: array
      - constants:
          resource_type: docker_container
  - id: cis-docker-1.2.0-5.4
    description: Containers should not run in privileged mode
    scope:
      - docker
    skipOnKubernetes: true
    imports:
      - container-generic-rule.rego
      - helpers.rego
    input:
      - tag: containers
        docker:
          kind: container
        type: array
      - constants:
          resource_type: docker_container
  - id: cis-docker-1.2.0-5.5
    description: Sensitive host system directories should not be mounted on containers
    scope:
      - docker
    skipOnKubernetes: true
    imports:
      - container-generic-rule.rego
      - helpers.rego
    input:
      - tag: containers
        docker:
          kind: container
        type: array
      - constants:
          resource_type: docker_container
  - id: cis-docker-1.2.0-5.7
    description: Privileged port mapping for containers should be restricted to increase security
    scope:
      - docker
    skipOnKubernetes: true
    imports:
      - container-generic-rule.rego
      - helpers.rego
    input:
      - tag: containers
        docker:
          kind: container
        type: array
      - constants:
          resource_type: docker_container
  - id: cis-docker-1.2.0-5.9
    description: The host's network namespace should be hidden from containers
    scope:
      - docker
    imports:
      - container-generic-rule.rego
      - helpers.rego
    input:
      - tag: containers
        docker:
          kind: container
        type: array
      - constants:
          resource_type: docker_container
  - id: cis-docker-1.2.0-5.10
    description: Containers should have memory usage limits configured on Docker hosts
    scope:
      - docker
    skipOnKubernetes: true
    imports:
      - container-generic-rule.rego
      - helpers.rego
    input:
      - tag: containers
        docker:
          kind: container
        type: array
      - constants:
          resource_type: docker_container
  - id: cis-docker-1.2.0-5.11
    description: The critical containers should be configured to remain responsive
    scope:
      - docker
    skipOnKubernetes: true
    imports:
      - container-generic-rule.rego
      - helpers.rego
    input:
      - tag: containers
        docker:
          kind: container
        type: array
      - constants:
          resource_type: docker_container
  - id: cis-docker-1.2.0-5.12
    description: The container's root filesystem should be set to read-only
    scope:
      - docker
    skipOnKubernetes: true
    imports:
      - container-generic-rule.rego
      - helpers.rego
    input:
      - tag: containers
        docker:
          kind: container
        type: array
      - constants:
          resource_type: docker_container
  - id: cis-docker-1.2.0-5.14
    description: The container should have a restart policy limited to 5 attempts
    scope:
      - docker
    skipOnKubernetes: true
    imports:
      - container-generic-rule.rego
      - helpers.rego
    input:
      - tag: containers
        docker:
          kind: container
        type: array
      - constants:
          resource_type: docker_container
  - id: cis-docker-1.2.0-5.15
    description: Processes in containers should have isolated Process ID (PID) namespaces
    scope:
      - docker
    skipOnKubernetes: true
    imports:
      - container-generic-rule.rego
      - helpers.rego
    input:
      - tag: containers
        docker:
          kind: container
        type: array
      - constants:
          resource_type: docker_container
  - id: cis-docker-1.2.0-5.16
    description: The IPC namespace on the host should remain isolated from containers
    scope:
      - docker
    skipOnKubernetes: true
    imports:
      - container-generic-rule.rego
      - helpers.rego
    input:
      - tag: containers
        docker:
          kind: container
        type: array
      - constants:
          resource_type: docker_container
  - id: cis-docker-1.2.0-5.20
    description: The UTS namespace should not be shared with the host
    scope:
      - docker
    skipOnKubernetes: true
    imports:
      - container-generic-rule.rego
      - helpers.rego
    input:
      - tag: containers
        docker:
          kind: container
        type: array
      - constants:
          resource_type: docker_container
  - id: cis-docker-1.2.0-5.21
    description: Incoming system calls should be filtered using enabled Seccomp profiles
    scope:
      - docker
    skipOnKubernetes: true
    imports:
      - container-generic-rule.rego
      - helpers.rego
    input:
      - tag: containers
        docker:
          kind: container
        type: array
      - constants:
          resource_type: docker_container
  - id: cis-docker-1.2.0-5.24
    description: Containers should use the cgroup configured in Docker
    scope:
      - docker
    skipOnKubernetes: true
    imports:
      - container-generic-rule.rego
      - helpers.rego
    input:
      - tag: containers
        docker:
          kind: container
        type: array
      - constants:
          resource_type: docker_container
  - id: cis-docker-1.2.0-5.25
    description: The container should restrict acquiring additional privileges via suid or sgid bits
    scope:
      - docker
    skipOnKubernetes: true
    imports:
      - container-generic-rule.rego
      - helpers.rego
    input:
      - tag: containers
        docker:
          kind: container
        type: array
      - constants:
          resource_type: docker_container
  - id: cis-docker-1.2.0-5.26
    description: The container's health should be constantly monitored
    scope:
      - docker
    skipOnKubernetes: true
    imports:
      - container-generic-rule.rego
      - helpers.rego
    input:
      - tag: containers
        docker:
          kind: container
        type: array
      - constants:
          resource_type: docker_container
  - id: cis-docker-1.2.0-5.28
    description: Container runtime should include the --pids-limit flag for cgroup limit parameter
    scope:
      - docker
    skipOnKubernetes: true
    imports:
      - container-generic-rule.rego
      - helpers.rego
    input:
      - tag: containers
        docker:
          kind: container
        type: array
      - constants:
          resource_type: docker_container
  - id: cis-docker-1.2.0-5.30
    description: Containers should not share the host's user namespaces
    scope:
      - docker
    skipOnKubernetes: true
    imports:
      - container-generic-rule.rego
      - helpers.rego
    input:
      - tag: containers
        docker:
          kind: container
        type: array
      - constants:
          resource_type: docker_container
  - id: cis-docker-1.2.0-5.31
    description: Containers should not mount the Docker socket docker.sock inside them
    scope:
      - docker
    skipOnKubernetes: true
    imports:
      - container-generic-rule.rego
      - helpers.rego
    input:
      - tag: containers
        docker:
          kind: container
        type: array
      - constants:
          resource_type: docker_container
