---
version: 1.0.0
rules:
  - id: credential_modified
    description: Sensitive credential files were modified using a non-standard tool
    expression: >-
      (open.filename == "/etc/shadow" || open.filename == "/etc/gshadow") &&
      process.name not in ["vipw", "vigr"]
    tags:
      technique: T1003
  - id: memory_dump
    description: Potential memory dump
    expression: >-
      open.filename =~ "/proc/*" && open.basename in ["maps", "mem"]
    tags:
      technique: T1003
  - id: logs_altered
    description: Log data was deleted
    expression: >-
      (open.filename =~ "/var/log/*" && open.flags & O_TRUNC > 0)
    tags:
      technique: T1070
  - id: logs_removed
    description: Log files were removed
    expression: >-
      unlink.filename =~ "/var/log/*"
    tags:
      technique: T1070
  - id: permissions_changed
    description: Permissions were changed on sensitive files
    expression: >-
      chmod.filename =~ "/etc/*" || chmod.filename =~ "/etc/*" ||
      chmod.filename =~ "/sbin/*" || chmod.filename =~ "/usr/sbin/*" ||
      chmod.filename =~ "/usr/local/sbin*" || chmod.filename =~ "/usr/bin/local/*" ||
      chmod.filename =~ "/var/log/*" || chmod.filename =~ "/usr/lib/*"
    tags:
      technique: T1222
  - id: hidden_file
    description: A hidden file was created
    expression: >-
      open.basename =~ ".*" && open.flags & O_CREAT > 0
    tags:
      technique: T1158
  - id: kernel_module
    description: A new kernel module was added
    expression: >-
      open.filename =~ "/lib/modules/*" && open.flags & O_CREAT > 0
    tags:
      technique: T1215
